# Code Review フェーズ

## subagent実行

このフェーズは**subagentとして実行**される。
**並列フェーズ (parallel_quality)** の一部として実行される。

---

## 目的

AIによるコードレビューを実施する。

## 入力

- タスクディレクトリ: `{workflowDir}`
- 実装コード
- テストコード
- 仕様書: `docs/specs/domains/{domain}/{name}.md`

## レビュー観点

### 1. 仕様との整合性

- [ ] 仕様書の要件が全て実装されているか
- [ ] 仕様と異なる実装がないか
- [ ] エッジケースが考慮されているか

### 2. コード品質

- [ ] 可読性は高いか
- [ ] 適切な命名がされているか
- [ ] コメントは必要十分か
- [ ] 重複コードがないか

### 3. エラーハンドリング

- [ ] 例外処理が適切か
- [ ] エラーメッセージが明確か
- [ ] リカバリー処理があるか

### 4. パフォーマンス

- [ ] 不要なループがないか
- [ ] N+1問題がないか
- [ ] メモリリークの可能性がないか

### 5. セキュリティ

- [ ] 入力検証がされているか
- [ ] SQLインジェクション対策
- [ ] XSS対策

### 6. テスト

- [ ] テストカバレッジは十分か
- [ ] エッジケースがテストされているか
- [ ] モックは適切か

## 出力ファイル

### `{workflowDir}/code-review.md`

```markdown
# コードレビュー結果

## レビュー対象

| ファイル           | 行数 | 変更内容 |
| ------------------ | ---- | -------- |
| `path/to/file1.ts` | 50   | [概要]   |
| `path/to/file2.ts` | 30   | [概要]   |

## レビュー結果

### 仕様との整合性

- [評価: OK/NG]
- [コメント]

### コード品質

- [評価: OK/NG]
- [コメント]

### エラーハンドリング

- [評価: OK/NG]
- [コメント]

### パフォーマンス

- [評価: OK/NG]
- [コメント]

### セキュリティ

- [評価: OK/NG]
- [コメント]

### テスト

- [評価: OK/NG]
- [コメント]

## 指摘事項

### 重要度: 高（修正必須）

1. **[指摘タイトル]**
   - ファイル: `path/to/file.ts:行番号`
   - 問題: [問題の説明]
   - 提案: [修正案]

### 重要度: 中（推奨）

1. **[指摘タイトル]**
   - ファイル: `path/to/file.ts:行番号`
   - 問題: [問題の説明]
   - 提案: [修正案]

### 重要度: 低（任意）

1. **[指摘タイトル]**
   - ファイル: `path/to/file.ts:行番号`
   - 問題: [問題の説明]
   - 提案: [修正案]

## 良かった点

1. [良い点1]
2. [良い点2]

## 結論

- [ ] 承認（指摘なし）
- [ ] 条件付き承認（軽微な修正後に続行可）
- [ ] 要修正（修正後に再レビュー必要）
```

## 禁止事項

- コードの編集（レビュー結果の記録のみ）
- 重要な指摘を無視して承認

## 完了条件

- [ ] 全ての観点でレビューした
- [ ] 指摘事項を記録した
- [ ] 結論を出した
- [ ] code-review.md を作成した
