# CI Verification フェーズ

## 目的

push後のCI/CDパイプライン実行結果を確認し、問題がないことを検証する。

## 入力

- タスクディレクトリ: `{workflowDir}`
- pushしたブランチ名
- GitHub リポジトリ

## 前提条件

- コードが GitHub にプッシュ済みであること
- CI/CD パイプラインが設定されていること

## 実行手順

1. **CI パイプラインの確認**

   ```bash
   # GitHub Actions のワークフロー実行状況を確認
   gh run list --limit 5

   # 最新の実行結果を詳細表示
   gh run view --log
   ```

2. **テスト結果の確認**

   - 全テストがパスしていること
   - テストカバレッジが目標値以上であること

3. **ビルド結果の確認**

   - ビルドが成功していること
   - 成果物が正しく生成されていること

4. **静的解析結果の確認**

   - ESLint エラーがないこと
   - TypeScript 型チェックが成功していること

5. **セキュリティスキャン結果の確認**

   - 脆弱性が検出されていないこと
   - 依存関係に問題がないこと

6. **失敗時の対応**
   - エラーログを確認
   - 問題を修正
   - 再プッシュして再実行

## チェックリスト

### GitHub Actions

- [ ] ワークフローが正常に開始された
- [ ] 全てのジョブが成功（緑）
- [ ] 失敗したジョブがない

### テスト

- [ ] 全テストがパス
- [ ] カバレッジが目標値以上
- [ ] 新規テストが正しく実行された

### ビルド

- [ ] ビルドが成功
- [ ] 成果物が正しく生成された
- [ ] バンドルサイズが許容範囲内

### 静的解析

- [ ] ESLint エラーがない
- [ ] TypeScript 型チェックが成功
- [ ] フォーマットが正しい

### セキュリティ

- [ ] セキュリティスキャンが成功
- [ ] 脆弱性が検出されていない
- [ ] 依存関係に問題がない

## 確認方法

### GitHub Actions タブで確認

1. リポジトリの Actions タブを開く
2. 該当のワークフロー実行を選択
3. 各ジョブの状態を確認
4. 詳細ログを確認

### CLI で確認

```bash
# ワークフロー実行一覧
gh run list

# 特定の実行の詳細
gh run view <run-id>

# ログを表示
gh run view <run-id> --log

# 失敗したジョブのログのみ
gh run view <run-id> --log-failed
```

## log.md への記録

```markdown
### CI_VERIFICATION（CI検証）

- GitHub Actions 結果:
  - ワークフロー: [ワークフロー名]
  - 実行ID: [run-id]
  - 状態: 成功 / 失敗
- テスト結果:
  - 合計: X件
  - パス: X件
  - 失敗: 0件
  - カバレッジ: XX%
- ビルド結果: 成功 / 失敗
- 静的解析: 成功 / 失敗
- セキュリティスキャン: 成功 / 失敗
- 修正した問題:
  - [問題1]: [対処]
```

## エラー対応

### テスト失敗

1. 失敗したテストを特定
2. ローカルで再現
3. 修正してプッシュ

### ビルド失敗

1. ビルドエラーを確認
2. 依存関係の問題か確認
3. ローカルでビルドして修正

### セキュリティ警告

1. 警告の内容を確認
2. 依存関係を更新
3. 必要に応じてコードを修正

## 禁止事項

- CI 失敗を無視して次に進む
- テストをスキップして CI を通す
- セキュリティ警告を放置する
- カバレッジ目標未達で次に進む

## 完了条件

- [ ] CI/CD パイプラインが全て成功
- [ ] 全テストがパス
- [ ] ビルドが成功
- [ ] 静的解析が成功
- [ ] セキュリティスキャンが成功
- [ ] 警告やエラーがない
- [ ] log.md に記録した
