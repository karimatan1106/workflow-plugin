# Research フェーズ

## subagent実行

このフェーズは**subagentとして実行**される。

### 実行時の注意

1. **独立して作業を完了すること**
2. **完了時はメイン会話に結果を報告すること**
3. **フェーズ指示に従って自律的に作業すること**（確認不要な判断でユーザーに聞かない）

---

## 目的

タスクの要件を理解し、既存コードを調査し、ユーザーと要件を確認する。

## 入力

- タスクディレクトリ: `{workflowDir}`
- タスク名: `log.md` の概要を参照

## 実行手順

### 0. ブランチ作成（複数名開発時は必須）

**複数人で同時開発する場合、最初にブランチを作成すること。**

```bash
# main を最新化
git checkout main
git pull origin main

# 作業ブランチ作成
git checkout -b {type}/issue-{番号}-{概要}
# 例: git checkout -b bugfix/issue-123-position-limit
```

### 1. タスクの理解

- `log.md` を読み、タスクの目的を把握
- 不明点があればリストアップ

2. **既存コードの調査**
   - 関連するファイルを特定
   - 現在の実装を理解
   - 問題点・改善点を特定

3. **調査結果の記録**
   - `research.md` に調査結果を書き込む

4. **要件の確認（壁打ち）**
   - 調査結果をもとにユーザーと議論
   - 不明点・曖昧な点を質問
   - 要件の優先度・スコープを確認
   - `requirements.md` に決定事項を記録

## 出力ファイル

### 1. 調査結果: `{workflowDir}/research.md`

```markdown
# 調査結果

## 関連ファイル

- `path/to/file1.ts` - 説明
- `path/to/file2.ts` - 説明

## 現状の動作

- ...

## 問題点・改善点

- ...

## 技術的な考慮事項

- ...
```

### 2. 要件定義記録: `{workflowDir}/requirements.md`

ユーザーとの議論・決定事項を記録する。

```markdown
# 要件定義記録

## タスク概要

- 目的: [何を達成したいか]
- 背景: [なぜこのタスクが必要か]

## ユーザーとの議論

### Q1: [質問内容]

- 回答: [ユーザーの回答]
- 決定: [決定事項]

### Q2: ...

## 確定した要件

### 機能要件

1. [必須機能]
2. ...

### 非機能要件

1. [パフォーマンス、セキュリティ等]
2. ...

### 対象外（スコープ外）

1. [今回対応しないこと]
2. ...

## 前提条件・制約

- [前提1]
- [制約1]
```

## 禁止事項

- コードの編集（読み取りのみ）
- 実装の開始
- 仕様の決定（要件確認前）

## 完了条件

- [ ] 作業ブランチを作成した（複数名開発時）
- [ ] 関連ファイルを全て特定した
- [ ] 現状の動作を理解した
- [ ] 問題点を明確化した
- [ ] ユーザーと要件を確認した
- [ ] requirements.md を作成した
- [ ] research.md を作成した
