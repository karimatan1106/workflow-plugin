# Test Design フェーズ

## subagent実行

このフェーズは**subagentとして実行**される。

---

## 目的

仕様書に基づいてテストケースを設計する。

## 入力

- タスクディレクトリ: `{workflowDir}`
- 仕様書: `docs/specs/domains/{domain}/{name}.md`
- ステートマシン図: `state-machine.mmd`
- フローチャート: `flowchart.mmd`

## 実行手順

1. **テスト対象の特定**
   - 各機能をテスト対象として抽出
   - 依存関係を整理

2. **テストケースの設計**
   - 正常系テスト
   - 異常系テスト
   - 境界値テスト
   - エッジケース

3. **テストデータの設計**
   - 入力データパターン
   - モックデータ

4. **テストカバレッジ目標**
   - ステートマシンの全状態遷移
   - フローチャートの全パス

## 出力ファイル

### `{workflowDir}/test-cases.md`

````markdown
# テストケース設計

## テスト対象

| コンポーネント    | ファイル           | 優先度 |
| ----------------- | ------------------ | ------ |
| [コンポーネント1] | `path/to/file.ts`  | 高     |
| [コンポーネント2] | `path/to/file2.ts` | 中     |

## テストケース

### TC-001: [テストケース名]

**分類**: 正常系 / 異常系 / 境界値
**優先度**: 高 / 中 / 低

**前提条件**:

- [条件1]
- [条件2]

**入力**:

```typescript
{
  param1: "value1",
  param2: 123
}
```
````

**期待結果**:

```typescript
{
  result: 'expected';
}
```

**確認ポイント**:

- [ ] [確認項目1]
- [ ] [確認項目2]

### TC-002: [エラーケース]

**分類**: 異常系
**優先度**: 高

**入力**:

```typescript
{
  param1: null; // 不正な入力
}
```

**期待結果**:

- エラーがスローされる
- エラーメッセージ: "..."

### TC-003: [境界値テスト]

**分類**: 境界値
**優先度**: 中

**テストデータ**:
| 値 | 期待結果 |
|----|---------|
| 0 | OK |
| -1 | エラー |
| MAX_INT | OK |
| MAX_INT + 1 | エラー |

## テストカバレッジ

### ステートマシンカバレッジ

| 状態遷移          | テストケース |
| ----------------- | ------------ |
| Idle → Loading    | TC-001       |
| Loading → Success | TC-001       |
| Loading → Error   | TC-002       |

### フローチャートカバレッジ

| パス       | テストケース |
| ---------- | ------------ |
| 正常パス   | TC-001       |
| エラーパス | TC-002       |
| 境界パス   | TC-003       |

## モック設計

### 外部依存

| 依存 | モック方法         |
| ---- | ------------------ |
| API  | vi.mock()          |
| DB   | テストDB           |
| 時刻 | vi.useFakeTimers() |

```

## 禁止事項

- ソースコードの編集
- テストコードの作成（設計のみ）

## 完了条件

- [ ] 全ての機能のテストケースを設計した
- [ ] 正常系・異常系・境界値を網羅した
- [ ] ステートマシンの全遷移をカバーした
- [ ] フローチャートの全パスをカバーした
- [ ] test-cases.md を作成した
```
