# Security Scan フェーズ

## subagent実行

このフェーズは**subagentとして実行**される。
**並列フェーズ (parallel_verification)** の一部として実行される。

---

## 目的

脅威モデルに基づいてセキュリティスキャンを実施する。

## 入力

- タスクディレクトリ: `{workflowDir}`
- 脅威モデル: `threat-model.md`
- 実装コード

## 実行手順

1. **依存関係の脆弱性スキャン**

   ```bash
   pnpm audit
   # または
   npm audit
   ```

2. **静的解析**

   ```bash
   # ESLint セキュリティルール
   npx eslint --plugin security .
   ```

3. **コード確認**
   - 脅威モデルの対策が実装されているか
   - OWASP Top 10 の対策

4. **結果の記録**
   - 発見した脆弱性を記録
   - 対策を提案

## チェックリスト

### OWASP Top 10

- [ ] A01: アクセス制御の不備
- [ ] A02: 暗号化の失敗
- [ ] A03: インジェクション
- [ ] A04: 安全でない設計
- [ ] A05: セキュリティ設定のミス
- [ ] A06: 脆弱で古いコンポーネント
- [ ] A07: 識別と認証の失敗
- [ ] A08: ソフトウェアとデータの整合性の失敗
- [ ] A09: セキュリティログとモニタリングの失敗
- [ ] A10: サーバーサイドリクエストフォージェリ

### 脅威モデル対策

- [ ] Spoofing対策が実装されている
- [ ] Tampering対策が実装されている
- [ ] Repudiation対策が実装されている
- [ ] Information Disclosure対策が実装されている
- [ ] DoS対策が実装されている
- [ ] Privilege Escalation対策が実装されている

## 出力ファイル

### `{workflowDir}/security-scan-report.md`

```markdown
# セキュリティスキャン結果

## スキャン概要

- スキャン日時: YYYY-MM-DD HH:MM
- スキャン対象: [対象ファイル/ディレクトリ]
- 使用ツール: npm audit, ESLint security plugin

## 依存関係スキャン結果

| 重要度   | 件数 |
| -------- | ---- |
| Critical | 0    |
| High     | 0    |
| Medium   | 0    |
| Low      | 0    |

### 発見された脆弱性

（なしの場合）
脆弱性は発見されませんでした。

### 対策が必要な項目

1. **[パッケージ名]**
   - 重要度: High
   - 説明: [脆弱性の説明]
   - 対策: `npm update [パッケージ名]`

## 静的解析結果

| カテゴリ         | 件数 |
| ---------------- | ---- |
| セキュリティ問題 | 0    |
| 警告             | 0    |

## 脅威モデル対策確認

| 脅威カテゴリ           | 対策状況 | コメント             |
| ---------------------- | -------- | -------------------- |
| Spoofing               | OK       | 認証機能実装済み     |
| Tampering              | OK       | 入力検証実装済み     |
| Repudiation            | OK       | ログ機能実装済み     |
| Information Disclosure | OK       | 暗号化実装済み       |
| DoS                    | OK       | レート制限実装済み   |
| Privilege Escalation   | OK       | 権限チェック実装済み |

## 結論

- [ ] セキュリティ問題なし
- [ ] 軽微な問題あり（対応推奨）
- [ ] 重大な問題あり（対応必須）
```

## 禁止事項

- 重大な脆弱性を無視して次に進む
- セキュリティスキャンをスキップする

## 完了条件

- [ ] 依存関係スキャンを実行した
- [ ] 静的解析を実行した
- [ ] 脅威モデル対策を確認した
- [ ] 重大な脆弱性がないことを確認した
- [ ] security-scan-report.md を作成した
