# Design Review フェーズ

## 承認必須

このフェーズでは**AIによる技術レビュー**と**ユーザーの明示的な承認**が必要です。

```
/workflow approve design
```

---

## 目的

1. AIが設計成果物を技術的にレビューする
2. レビュー結果をユーザーに提示する
3. ユーザーの承認を得る

## 入力

- タスクディレクトリ: `{workflowDir}`
- 仕様書: `docs/specs/domains/{domain}/{name}.md`
- ステートマシン図: `docs/specs/domains/{domain}/{name}.state-machine.mmd`
- フローチャート: `docs/specs/domains/{domain}/{name}.flowchart.mmd`
- UI設計: `ui-design.md`
- 脅威モデル: `threat-model.md`

## 実行手順

### ステップ1: AIによる技術レビュー

以下の観点でAIが自動的にレビューを実施：

#### 1. 設計原則

- [ ] 単一責任の原則（SRP）に従っているか
- [ ] オープン/クローズドの原則（OCP）に従っているか
- [ ] 依存性逆転の原則（DIP）に従っているか

#### 2. 拡張性

- [ ] 将来の変更に対応しやすいか
- [ ] 適切な抽象化がされているか
- [ ] 過度な複雑性がないか

#### 3. パフォーマンス

- [ ] ボトルネックがないか
- [ ] 不要なループ・処理がないか
- [ ] キャッシュ戦略は適切か

#### 4. セキュリティ

- [ ] 入力検証は十分か
- [ ] 認証・認可は適切か
- [ ] 脅威モデルの対策が反映されているか

#### 5. 保守性

- [ ] コードの可読性は高いか
- [ ] テスタビリティは確保されているか
- [ ] ドキュメントは十分か

### ステップ2: レビューサマリーの作成

- 主要な設計決定をまとめる
- トレードオフを説明
- 指摘事項があれば記録

### ステップ3: ユーザーへの提示

- 設計概要を説明
- AIレビュー結果を提示
- 質問や懸念点を確認

### ステップ4: 承認の取得

- ユーザーから `/workflow approve design` を受ける

## チェックリスト

### 成果物確認

- [ ] 仕様書が docs/specs/ にある
- [ ] ステートマシン図が docs/specs/ にある
- [ ] フローチャートが docs/specs/ にある
- [ ] UI設計が完了している（UI変更がある場合）
- [ ] 脅威モデルが作成されている

### 品質確認

- [ ] 要件が全て設計に反映されている
- [ ] エラーケースが網羅されている
- [ ] セキュリティ対策が設計に含まれている

## 出力ファイル

### `{workflowDir}/design-review.md`

```markdown
# 設計レビュー

## レビュー対象

| 成果物         | パス                                                   | 状態   |
| -------------- | ------------------------------------------------------ | ------ |
| 仕様書         | `docs/specs/domains/{domain}/{name}.md`                | OK     |
| ステートマシン | `docs/specs/domains/{domain}/{name}.state-machine.mmd` | OK     |
| フローチャート | `docs/specs/domains/{domain}/{name}.flowchart.mmd`     | OK     |
| UI設計         | `ui-design.md`                                         | OK/N/A |
| 脅威モデル     | `threat-model.md`                                      | OK     |

## AIレビュー結果

### 設計原則

| 原則 | 評価  | コメント   |
| ---- | ----- | ---------- |
| SRP  | OK/NG | [コメント] |
| OCP  | OK/NG | [コメント] |
| DIP  | OK/NG | [コメント] |

### 拡張性

- [評価と改善提案]

### パフォーマンス

- [評価と改善提案]

### セキュリティ

- [評価と改善提案]

### 保守性

- [評価と改善提案]

## 指摘事項

### 重要度: 高

1. [指摘内容]
   - 理由: [理由]
   - 対策: [対策]

### 重要度: 中

1. [指摘内容]

### 重要度: 低

1. [指摘内容]

## 設計サマリー

### 主要な設計決定

1. [決定1]
   - 理由: [理由]
   - トレードオフ: [トレードオフ]

### 影響範囲

- 変更対象ファイル: [ファイル一覧]
- 影響を受ける機能: [機能一覧]

## 結論

- [ ] 承認推奨（指摘なし）
- [ ] 条件付き承認推奨（軽微な修正後に続行可）
- [ ] 要修正（修正後に再レビュー必要）

## 承認状態

- 承認者: （ユーザーが承認後に記録）
- 承認日時: （承認後に記録）
```

## 禁止事項

- コードの編集
- ユーザー承認なしで次フェーズに進む

## 完了条件

- [ ] AIによる技術レビューを実施した
- [ ] 全ての成果物を確認した
- [ ] レビューサマリーを作成した
- [ ] ユーザーに説明した
- [ ] **ユーザーから承認を得た**
