# Implementation フェーズ (TDD Green)

## subagent実行

このフェーズは**subagentとして実行**される。

---

## 目的

仕様書とテストに基づいてコードを実装する（TDD Green フェーズ）。

**重要**: テストを通すための最小限の実装を行う。

## 入力

- タスクディレクトリ: `{workflowDir}`
- 仕様書: `docs/specs/domains/{domain}/{name}.md`
- ステートマシン図: `state-machine.mmd`
- フローチャート: `flowchart.mmd`
- テストケース: `test-cases.md`
- テストコード: `*.test.ts`

## 実行手順

1. **仕様書の確認**
   - 仕様書の要件を確認
   - 変更対象ファイルを特定

2. **実装**
   - テストを通すための実装
   - フローチャートの各ノードを実装
   - エッジケースを考慮

3. **テスト実行（成功確認）**
   - 全テストが通ることを確認
   - 「Green」状態を確認

4. **コード品質**
   - TypeScript型を適切に定義
   - エラーハンドリングを実装

## 実装ルール

### やるべきこと

- 仕様書の設計に忠実に実装
- テストを通す最小限の実装
- フローチャートの全パスを実装
- 型安全なコードを書く

### やってはいけないこと

- 仕様書にない機能を追加
- 過度な抽象化（次のリファクタリングフェーズで行う）
- any型の使用
- **テストファイルの編集**

### コードと仕様書の紐付け【必須】

#### 新規ファイル作成時

1. ファイル先頭に `@spec` コメントを追加:

   ```typescript
   /**
    * コンポーネント/サービス名
    * @spec docs/specs/domains/{domain}/{name}.md
    */
   ```

2. 対応する仕様書の `@related-files` を更新

## 出力ファイル

- 変更されたソースコードファイル

## log.md への記録

```markdown
### IMPLEMENTATION（実装 - TDD Green）

- 実装した内容:
  - [機能1]
  - [機能2]
- 変更ファイル:
  - `path/to/file1.ts:行番号` - 変更内容
  - `path/to/file2.ts:行番号` - 変更内容
- テスト結果: 全 X 件パス（Green）
```

## 禁止事項

- テストファイルの編集
- 仕様書にない機能の追加
- リファクタリング（次のフェーズで行う）

## 完了条件

- [ ] 仕様書の全要件を実装した
- [ ] フローチャートの全パスを実装した
- [ ] **全テストがパスした（Green）**
- [ ] @spec コメントを追加した
- [ ] log.md に実装内容を記録した
